---
layout: post
title:  "[Sqlite]MJ write 시도"
date:   2016-08-02 20:50:00 +0000
categories: sqlite
tags: sqlite
---

- 후에 마스터저널을 사용하기 위해서, 저널 파일에 마스터저널의 이름(full path)을 저장하고 읽어야 한다.

- 기존 sqlite에서는 `writeMasterJournal()`과 `readMasterJournal()`을 사용한다. wal모드의 경우 현재 두 함수를 사용하지 않는다.(assert를 통해 체크된다)

- 기존 sqlite에서는 마스터저널의 이름을 저장할 때 저널 파일의 맨 뒤에 저장한다. 마스터저널의 생성은 commit단계에서 일어나고 commit이 끝날 때까지 저널에 데이터가 쓰이지 않기 때문에, 문제가 없다.

- 하지만 WAL모드의 경우, commit중에도 저널 파일에 데이터가 쓰이기 때문에 이런 방법을 사용할 수 없다.

- 헤더를 늘리는 방법을 먼저 시도해보았다.

  1. WAL의 헤더를 32바이트에서 36바이트로 늘리고 간단한 테스트 코드를 실행했다.

  2. 기존의 wal파일을 잘못된 db로 인식한다. 추후에 이 방법이 완전히 적용된다면 기존 wal 파일의 처리도 필요.

  3. 처음엔 문제가 생겼으나 실행을 반복하다보니 정상적으로 작동했다. 기존 저널파일을 깨끗하게 처리하지 못했던 것이 문제였던 듯 하다.
